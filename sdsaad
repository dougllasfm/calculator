'WITH PARAMS AS ('
  '/*'
'   select null as nufin'
'   ,null as NUMNOTA'
'   ,null as codproj'
'   ,null as codnat'
'   ,null as codparc'
'   ,null as codctabcoint'
'   , 1 as receita'
'   ,-1 as despesa'
'   ,"S" as provisao '
'   ,"S" as baixados'
'   ,"S" as naobaixados'
'   ,"S" as conciliados'
'   ,"S" as naoconciliados'
'   ,"B" as tipoperiodo'
'   ,"01/12/18" as periodoini'
'   ,"31/12/18" as periodofin        '
'   from dual'
'   */'
  'SELECT'
    ':NUFIN AS NUFIN,'
    ':NUMNOTA AS NUMNOTA,'
    ':CODPROJ AS CODPROJ,'
    ':CODNAT AS CODNAT,'
    ':CODCENCUS AS CODCENCUS,'
    ':CODPARC AS CODPARC,'
    ':CODCTABCOINT AS CODCTABCOINT,'
'CASE'
      'WHEN 1 IN :FIN THEN 1'
    'END AS RECEITA,'
'CASE'
      'WHEN -1 IN :FIN THEN -1'
    'END AS DESPESA,'
'CASE'
      'WHEN 2 IN :FIN THEN "S"'
      'ELSE "N"'
    'END AS PROVISAO,'
'CASE'
      'WHEN 1 IN :STATUS THEN "S"'
      'ELSE "N"'
    'END AS BAIXADOS,'
'CASE'
      'WHEN 2 IN :STATUS THEN "S"'
      'ELSE "N"'
    'END AS NAOBAIXADOS,'
'CASE'
      'WHEN 3 IN :STATUS THEN "S"'
      'ELSE "N"'
    'END AS CONCILIADOS,'
'CASE'
      'WHEN 4 IN :STATUS THEN "S"'
      'ELSE "N"'
    'END AS NAOCONCILIADOS,'
    ':TIPOPERIODO AS TIPOPERIODO,'
    ':PERIODO.INI AS PERIODOINI,'
    ':PERIODO.FIN AS PERIODOFIN'
  'FROM'
    'DUAL'
'),'
'FIN AS ('
  'SELECT'
    'RAT.CODEMP AS LANC_CODEMP,'
    'EMPR.NOMEFANTASIA AS LANC_NOMEEMP,'
    'CTA.CODEMP AS BAIXA_CODEMP,'
    'EMPC.NOMEFANTASIA AS BAIXA_NOMEEMP,'
    'DECODE(RAT.PROVISAO, "N", "Não", "Sim") PROVISAO,'
    'RAT.RECDESP,'
    'RAT.NUFIN,'
    'RAT.NUMNOTA,'
    'RAT.CODPARC,'
    'PAR.RAZAOSOCIAL,'
    'RAT.CODNAT,'
    'NAT.DESCRNAT,'
    'RAT.CODPROJ,'
    'PJR.IDENTIFICACAO,'
    'RAT.CODCENCUS,'
    'CUS.DESCRCENCUS,'
    'RAT.VLRDESDOB * RAT.RECDESP AS VLRDESDOB,'
    'RAT.VLRLIQUIDO * RAT.RECDESP AS VLRLIQUIDO,'
    'RAT.VLRBAIXA * RAT.RECDESP AS VLRBAIXA,'
    'RAT.DTNEG,'
    'RAT.DTVENC,'
    'RAT.DHBAIXA,'
    'MBC.DHCONCILIACAO,'
    'RAT.HISTORICO,'
    'CTA.CODCTABCO || " - " || CTA.DESCRICAO AS CONTA_BANCARIA,'
    'SANKHYA.FC_GET_OPCAO_CAMPO("TSICTA", "CLASSE", CTA.CLASSE) AS CLASSE,'
    'TO_CHAR(RAT.AD_DATAPAG, "DD/MM/YYYY") AS AD_DATAPAG'
  'FROM'
    'PARAMS,'
    'VGFFINRAT RAT'
    'INNER JOIN TSIEMP EMPR ON EMPR.CODEMP = RAT.CODEMP'
    'INNER JOIN TGFNAT NAT ON NAT.CODNAT = RAT.CODNAT'
    'INNER JOIN TGFPAR PAR ON PAR.CODPARC = RAT.CODPARC'
    'INNER JOIN TCSPRJ PJR ON PJR.CODPROJ = RAT.CODPROJ'
    'INNER JOIN TSICUS CUS ON CUS.CODCENCUS = RAT.CODCENCUS'
    'LEFT JOIN TGFMBC MBC ON MBC.NUBCO = RAT.NUBCO'
    'LEFT JOIN TSICTA CTA ON CTA.CODCTABCOINT = NVL(MBC.CODCTABCOINT, RAT.CODCTABCOINT)'
    'LEFT JOIN TSIEMP EMPC ON EMPC.CODEMP = CTA.CODEMP'
  'WHERE'
    '('
      'RAT.PROVISAO = "N"'
      'OR ('
        'RAT.PROVISAO = "S"'
        'AND PARAMS.PROVISAO = "S"'
      ')'
    ')'
    'AND RAT.RECDESP IN (PARAMS.RECEITA, PARAMS.DESPESA)'
    'AND ('
      '('
        'PARAMS.BAIXADOS = "S"'
        'AND RAT.DHBAIXA IS NOT NULL'
      ')'
      'OR ('
        'PARAMS.NAOBAIXADOS = "S"'
        'AND RAT.DHBAIXA IS NULL'
      ')'
    ')'
    'AND('
      '('
        'PARAMS.CONCILIADOS = "S"'
        'AND MBC.DHCONCILIACAO IS NOT NULL'
      ')'
      'OR ('
        'PARAMS.NAOCONCILIADOS = "S"'
        'AND MBC.DHCONCILIACAO IS NULL'
      ')'
    ')'
    'AND ('
      '('
        'PARAMS.TIPOPERIODO = "B"'
        'AND RAT.DHBAIXA IS NOT NULL'
        'AND RAT.DHBAIXA BETWEEN PARAMS.PERIODOINI'
        'AND PARAMS.PERIODOFIN'
      ')'
      'OR ('
        'PARAMS.TIPOPERIODO = "V"'
        'AND RAT.DTVENC BETWEEN PARAMS.PERIODOINI'
        'AND PARAMS.PERIODOFIN'
      ')'
      'OR ('
        'PARAMS.TIPOPERIODO = "N"'
        'AND RAT.DTNEG BETWEEN PARAMS.PERIODOINI'
        'AND PARAMS.PERIODOFIN'
      ')'
      'OR ('
        'PARAMS.TIPOPERIODO = "C"'
        'AND TO_DATE(MBC.DHCONCILIACAO) BETWEEN PARAMS.PERIODOINI'
        'AND PARAMS.PERIODOFIN'
      ')'
      'OR ('
        'PARAMS.TIPOPERIODO = "E"'
        'AND TO_DATE(RAT.AD_DATAPAG) BETWEEN PARAMS.PERIODOINI'
        'AND PARAMS.PERIODOFIN'
      ')'
    ')'
    'AND ('
      'RAT.CODPARC = PARAMS.CODPARC'
      'OR PARAMS.CODPARC IS NULL'
    ')'
    'AND ('
      'RAT.CODNAT = PARAMS.CODNAT'
      'OR PARAMS.CODNAT IS NULL'
    ')'
    'AND ('
      'RAT.CODCENCUS = PARAMS.CODCENCUS'
      'OR PARAMS.CODCENCUS IS NULL'
    ')'
    'AND ('
      'RAT.CODPROJ = PARAMS.CODPROJ'
      'OR PARAMS.CODPROJ IS NULL'
    ')'
    'AND ('
      'RAT.NUMNOTA = PARAMS.NUMNOTA'
      'OR PARAMS.NUMNOTA IS NULL'
    ')'
    'AND ('
      'RAT.NUFIN = PARAMS.NUFIN'
      'OR PARAMS.NUFIN IS NULL'
    ')'
    'AND (RAT.CODEMP IN :EMPRESAS)'
    'AND ('
      'MBC.CODCTABCOINT = PARAMS.CODCTABCOINT'
      'OR PARAMS.CODCTABCOINT IS NULL'
    ')'
    'AND CTA.CLASSE IN :CLASSE'
'),'
'MBC AS ('
  'SELECT'
    'CTA.CODEMP AS LANC_CODEMP,'
    'EMP.NOMEFANTASIA AS LANC_NOMEEMP,'
    'CTA.CODEMP AS BAIXA_CODEMP,'
    'EMP.NOMEFANTASIA AS BAIXA_NOMEEMP,'
    '"Não" AS PROVISAO,'
    'MBC.RECDESP,'
    'NUBCO AS NUFIN,'
    'MBC.NUMDOC AS NUMNOTA,'
    '0 AS CODPARC,'
    '"MOVIMENTO BANCÁRIO" AS RAZAOSOCIAL,'
    '0 AS CODNAT,'
    'CASE'
      'MBC.ORIGMOV'
      'WHEN "T" THEN "TRANSFERÊNCIA"'
      'WHEN "S" THEN "SAQUE"'
      'WHEN "R" THEN "RESGATE"'
      'WHEN "F" THEN "FINANCEIRO"'
      'WHEN "A" THEN "APLICAÇÃO"'
      'WHEN "D" THEN "DEPÓSITO"'
      'ELSE "DESCONHECIDA"'
    'END AS DESCRNAT,'
    '0 AS CODPROJ,'
    '"" AS IDENTIFICACAO,'
    '0 AS CODCENCUS,'
    '"" AS DESCRCENCUS,'
    'MBC.VLRLANC * RECDESP AS VLRDESDOB,'
    'MBC.VLRLANC * RECDESP AS VLRLIQUIDO,'
    'MBC.VLRLANC * RECDESP AS VLRBAIXA,'
    'MBC.DTINCLUSAO AS DTNEG,'
    'NULL AS DTVENC,'
    'MBC.DTINCLUSAO AS DHBAIXA,'
    'MBC.DHCONCILIACAO,'
    'MBC.HISTORICO,'
    'CTA.CODCTABCO || " - " || CTA.DESCRICAO AS CONTA_BANCARIA,'
    'SANKHYA.FC_GET_OPCAO_CAMPO("TSICTA", "CLASSE", CTA.CLASSE) AS CLASSE,'
    'NULL AS AD_DATAPAG'
  'FROM'
    'PARAMS,'
    'TGFMBC MBC'
    'INNER JOIN TSICTA CTA ON CTA.CODCTABCOINT = MBC.CODCTABCOINT'
    'INNER JOIN TSIEMP EMP ON EMP.CODEMP = CTA.CODEMP'
  'WHERE'
    'NOT EXISTS ('
      'SELECT'
        'FIN.NUBCO'
      'FROM'
        'TGFFIN FIN'
      'WHERE'
        'FIN.NUBCO = MBC.NUBCO'
    ') --LANCAMENTOS DIRETO NO FINANCEIRO'
    'AND (MBC.RECDESP IN (PARAMS.RECEITA, PARAMS.DESPESA))'
    'AND('
      '('
        'PARAMS.CONCILIADOS = "S"'
        'AND MBC.DHCONCILIACAO IS NOT NULL'
      ')'
      'OR ('
        'PARAMS.NAOCONCILIADOS = "S"'
        'AND MBC.DHCONCILIACAO IS NULL'
      ')'
    ')'
    'AND ('
      '('
        'PARAMS.TIPOPERIODO = "C"'
        'AND TO_DATE(MBC.DHCONCILIACAO) BETWEEN PARAMS.PERIODOINI'
        'AND PARAMS.PERIODOFIN'
      ')'
      'OR ('
        'PARAMS.TIPOPERIODO <> "C"'
        'AND TO_DATE(MBC.DTINCLUSAO) BETWEEN PARAMS.PERIODOINI'
        'AND PARAMS.PERIODOFIN'
      ')'
    ')'
    'AND PARAMS.TIPOPERIODO <> "E"'
    'AND (PARAMS.CODPARC IS NULL)'
    'AND (NVL(PARAMS.CODNAT, 0) = 0)'
    'AND (NVL(PARAMS.CODCENCUS, 0) = 0)'
    'AND (NVL(PARAMS.CODPROJ, 0) = 0)'
    'AND ('
      'MBC.NUMDOC = PARAMS.NUMNOTA'
      'OR PARAMS.NUMNOTA IS NULL'
    ')'
    'AND (NVL(PARAMS.NUFIN, 0) = 0)'
    'AND (CTA.CODEMP IN :EMPRESAS)'
    'AND ('
      'MBC.CODCTABCOINT = PARAMS.CODCTABCOINT'
      'OR PARAMS.CODCTABCOINT IS NULL'
    ')'
    'AND CTA.CLASSE IN :CLASSE'
')'
'SELECT'
  '*'
'FROM'
  'FIN'
'UNION'
'ALL'
'SELECT'
  '*'
'FROM'
  'MBC'